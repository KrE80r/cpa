(()=>{var I=Object.defineProperty;var y=(o,t,e)=>t in o?I(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var p=(o,t)=>()=>(t||o((t={exports:{}}).exports,t),t.exports);var f=(o,t,e)=>(y(o,typeof t!="symbol"?t+"":t,e),e);var _=p(g=>{var L={ItemsList_Kette:"Store Chain",ItemsList_Name:"Name",ItemsList_Preis:"Price",ItemsList_Aktionen:"Actions","ItemsList_Preis aufsteigend":"Price ascending","ItemsList_Preis absteigend":"Price descending","ItemsList_Kette &amp; Name":"Store &amp; Name",ItemsList_Sortieren:"Sort by",ItemsList_Namens\u00E4hnlichkeit:"Name similarity","ItemsList_Menge aufsteigend":"Quantity ascending","ItemsList_Menge absteigend":"Quantity descending",ItemsList_Resultate:"Results",ItemsList_Diagramm:"Chart",ItemsList_Verkaufspreis:"Unit price",ItemsList_Mengenpreis:"Bulk price",ItemsFilter_Product_Search:"Product search...",ItemsFilter_Toggle_Filters:"Show/hide filters",ItemsFilter_All:"All",ItemsFilter_Date:"Date",ItemsFilter_Cheaper_Since_Last_Change:"Cheaper since last change",ItemsFilter_Discount_Store_Brands:"Discount store brands only",ItemsFilter_Organic_Only:"Only organic",ItemsFilter_Exact_Word:"Exact word",ItemsFilter_Price:"Price A$",ItemsFilter_More_Expensive:"More expensive",ItemsFilter_Cheaper:"Cheaper",ItemsFilter_Min_Characters:"(min. 3 characters)","ItemsFilter_Preis $":"Price $","ItemsFilter_Exaktes Wort":"Exact word","ItemsFilter_Nur Bio":"Bio only","ItemsChart_Preissumme Gesamt":"Total price sum","ItemsChart_Preissumme Ketten":"Store price sums","ItemsChart_Nur heutige Preise":"Today's prices only","ItemsChart_Preissumme {{s}}":"Price sum {{s}}","ItemsChart_Keine Daten ausgew\xE4hlt":"No data selected",CartsList_Name:"Name",CartsList_Produkte:"Products",CartsList_Preis:"Price",CartsList_Preis\u00E4nderungen:"Price",CartsList_Teilen:"Share","Settings_Vorselektierte Ketten":"Preselected stores",alternative:"alternative",alternatives:"alternatives","Shopping_lists_are_stored_locally_on_this_device_only.":"Shopping lists are stored locally on this device only.","Your_shopping_list_is_stored_locally_on_this_device_only.":"Your shopping list is stored locally on this device only.","shopping_lists_are_stored_locally_on_this_device_only.":"shopping lists are stored locally on this device only.",Your:"Your"};function w(o,t={}){let e=L[o]||o;if(t&&typeof t=="object")for(let[i,s]of Object.entries(t))e=e.replace(new RegExp(`{{${i}}}`,"g"),s);return e}g.__=w});var S=p((k,v)=>{var{__:n}=_(),c=class{static validate(t){if(!t.version)return{valid:!1,error:"Missing version field"};if(t.version!=="1.0")return{valid:!1,error:`Unsupported version: ${t.version}`};if(!t.list||typeof t.list!="object")return{valid:!1,error:"Missing or invalid list data"};let e=t.list;if(!e.name||typeof e.name!="string")return{valid:!1,error:"Missing or invalid list name"};if(!Array.isArray(e.stores))return{valid:!1,error:"Missing or invalid stores array"};if(!Array.isArray(e.items))return{valid:!1,error:"Missing or invalid items array"};for(let i of e.stores)if(!this.VALID_STORES.includes(i))return{valid:!1,error:`Invalid store name: ${i}`};for(let i=0;i<e.items.length;i++){let s=e.items[i];if(!s.mainRef||typeof s.mainRef!="object")return{valid:!1,error:`Item ${i}: missing mainRef`};if(!s.mainRef.store||!s.mainRef.id)return{valid:!1,error:`Item ${i}: invalid mainRef structure`};if(!this.VALID_STORES.includes(s.mainRef.store))return{valid:!1,error:`Item ${i}: invalid store in mainRef: ${s.mainRef.store}`};if(!Array.isArray(s.alternativeRefs))return{valid:!1,error:`Item ${i}: invalid alternativeRefs`};for(let r=0;r<s.alternativeRefs.length;r++){let a=s.alternativeRefs[r];if(!a.store||!a.id)return{valid:!1,error:`Item ${i}, alt ${r}: invalid reference structure`};if(!this.VALID_STORES.includes(a.store))return{valid:!1,error:`Item ${i}, alt ${r}: invalid store: ${a.store}`};if(a.quantity!==void 0&&(typeof a.quantity!="number"||a.quantity<=0))return{valid:!1,error:`Item ${i}, alt ${r}: quantity must be a positive number`}}if(s.selected&&!["main","alt"].includes(s.selected))return{valid:!1,error:`Item ${i}: invalid selected value: ${s.selected}`}}return e.createdAt&&isNaN(Date.parse(e.createdAt))?{valid:!1,error:"Invalid createdAt timestamp"}:e.updatedAt&&isNaN(Date.parse(e.updatedAt))?{valid:!1,error:"Invalid updatedAt timestamp"}:{valid:!0}}};f(c,"VALID_STORES",["aldi","coles","woolies","iga"]);var m=class{constructor(){this.lists=[],this.init()}init(){this.loadLists(),this.setupEventListeners(),this.render()}loadLists(){this.lists=[];for(let t=0;t<localStorage.length;t++){let e=localStorage.key(t);if(e&&e.startsWith("shopping_list_"))try{let i=JSON.parse(localStorage.getItem(e));this.lists.push(i)}catch(i){console.error(`Failed to load list ${e}:`,i)}}this.lists.sort((t,e)=>new Date(e.createdAt)-new Date(t.createdAt))}setupEventListeners(){let t=document.getElementById("newListBtn"),e=document.getElementById("createFirstBtn"),i=document.getElementById("importHeaderBtn"),s=document.getElementById("importFirstBtn"),r=document.getElementById("import-file-input"),a=document.getElementById("cancelBtn"),l=document.getElementById("createBtn"),u=document.getElementById("newListModal"),h=document.getElementById("listNameInput");t&&t.addEventListener("click",()=>this.showNewListModal()),e&&e.addEventListener("click",()=>this.showNewListModal()),i&&i.addEventListener("click",()=>this.triggerImport()),s&&s.addEventListener("click",()=>this.triggerImport()),r&&r.addEventListener("change",d=>this.handleImportFile(d)),a&&a.addEventListener("click",()=>this.hideNewListModal()),l&&l.addEventListener("click",()=>this.createList()),u&&u.addEventListener("click",d=>{d.target.id==="newListModal"&&this.hideNewListModal()}),h&&h.addEventListener("keypress",d=>{d.key==="Enter"&&this.createList()})}showNewListModal(){let t=document.getElementById("newListModal"),e=document.getElementById("listNameInput");!t||!e||(t.classList.remove("hidden"),e.value="",document.querySelectorAll(".store-checkbox").forEach(i=>i.checked=!1),setTimeout(()=>e.focus(),100))}hideNewListModal(){let t=document.getElementById("newListModal");t&&t.classList.add("hidden")}createList(){let e=document.getElementById("listNameInput").value.trim();if(!e){alert(n("Please enter a list name"));return}let i=Array.from(document.querySelectorAll(".store-checkbox:checked")).map(a=>a.value);if(i.length===0){alert(n("Please select at least one store"));return}let s="sl_"+Date.now(),r={id:s,name:e,stores:i,items:[],createdAt:new Date().toISOString()};localStorage.setItem(`shopping_list_${s}`,JSON.stringify(r)),this.loadLists(),this.render(),this.hideNewListModal(),window.location.href=`shopping-list-detail.html?id=${s}`}deleteList(t){confirm(n("Delete this list?"))&&(localStorage.removeItem(`shopping_list_${t}`),this.loadLists(),this.render())}updateStorageWarning(){let t=document.getElementById("storageWarningContent");if(!t)return;let e=this.lists.length;e===0?t.innerHTML=`<p>${n("Shopping_lists_are_stored_locally_on_this_device_only.")}</p>`:e===1?t.innerHTML=`<p>${n("Your_shopping_list_is_stored_locally_on_this_device_only.")}</p>`:t.innerHTML=`<p>${n("Your")} ${e} ${n("shopping_lists_are_stored_locally_on_this_device_only.")}</p>`}render(){let t=document.getElementById("listsContainer"),e=document.getElementById("emptyState");if(!(!t||!e)){if(this.updateStorageWarning(),this.lists.length===0){t.innerHTML="",e.classList.remove("hidden");return}e.classList.add("hidden"),t.innerHTML=this.lists.map(i=>{let s=i.items?i.items.length:0,r=i.stores.map(l=>({woolies:"Woolworths",coles:"Coles",aldi:"ALDI",iga:"IGA"})[l]||l).join(", "),a=new Date(i.createdAt).toLocaleDateString();return`
                <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                    <div class="flex items-start justify-between">
                        <div class="flex-1 cursor-pointer" onclick="window.location.href='shopping-list-detail.html?id=${i.id}'">
                            <h3 class="text-lg font-semibold mb-1">${this.escapeHtml(i.name)}</h3>
                            <div class="text-sm text-gray-600 space-y-1">
                                <div>\u{1F4E6} ${s} ${n(s===1?"item":"items")}</div>
                                <div>\u{1F3EA} ${r}</div>
                                <div>\u{1F4C5} ${a}</div>
                            </div>
                        </div>
                        <div class="flex gap-2 ml-4">
                            <button onclick="window.location.href='shopping-list-detail.html?id=${i.id}'"
                                    class="px-3 py-2 text-primary hover:bg-primary/10 rounded-lg transition-colors min-h-[44px]"
                                    title="${n("View list")}">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                </svg>
                            </button>
                            <button onclick="shoppingListsManager.deleteList('${i.id}')"
                                    class="px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors min-h-[44px]"
                                    title="${n("Delete list")}">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            `}).join("")}}triggerImport(){document.getElementById("import-file-input").click()}handleImportFile(t){let e=t.target.files[0];if(!e)return;if(!e.name.endsWith(".json")){alert(n("Please select a JSON file")),t.target.value="";return}let i=new FileReader;i.onload=s=>{try{let r=s.target.result;this.importList(r)}catch(r){console.error("File read failed:",r),alert(n("Failed to read file"))}finally{t.target.value=""}},i.onerror=()=>{alert(n("Failed to read file")),t.target.value=""},i.readAsText(e)}importList(t){try{let e;try{e=JSON.parse(t)}catch{alert(n("Invalid JSON format"));return}let i=c.validate(e);if(!i.valid){alert(n(i.error)),console.error("Validation failed:",i.error);return}let s=n(`Import "${e.list.name}" as a new list?`);if(!confirm(s))return;let r="sl_"+Date.now(),a={id:r,name:e.list.name,stores:e.list.stores,items:e.list.items,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};try{localStorage.setItem(`shopping_list_${r}`,JSON.stringify(a))}catch(l){if(l.name==="QuotaExceededError"){alert(n("Storage full! Please delete old lists to make space."));return}throw l}console.log(`Created new list from import: ${a.name} (${a.items.length} items)`),window.location.href=`shopping-list-detail.html?id=${r}`}catch(e){console.error("Import failed:",e),alert(n("Failed to import list"))}}escapeHtml(t){let e=document.createElement("div");return e.textContent=t,e.innerHTML}};window.shoppingListsManager=new m;v.exports={ShoppingListsManager:m,ImportValidator:c}});S();})();
//# sourceMappingURL=shopping-list.js.map
